import{c as H,d as R,o as g,i as b,w as t,j as s,u as e,m as f,k as i,v as $,Q as L,R as T,T as z,S as W,a as S,J as V,V as O,W as G,A as J,h as D,B as K,C as Q,D as X,E as B,F as Y,I as Z,e as ee,N,L as I,f as h,s as ae,a5 as se,M as te,P as le,p as ne,q as U,O as oe,a0 as P,aN as re}from"./app-DtN2HjBM.js";import{e as q,F as ie,_ as ce,a as de,b as ue,c as me,d as fe,f as M,u as pe}from"./Input.vue_vue_type_script_setup_true_lang-B9yC9ZSq.js";import{E as _e,_ as ge,S as he,a as ve,b as $e,c as ke,g as A,e as we,f as xe,h as ye,i as Pe,j as be,k as Se,l as De,m as Re}from"./FilterBarPresentation.vue_vue_type_script_setup_true_lang-QBD1Re61.js";import{_ as Ce,a as Ee,b as Ae,c as Fe,d as Ie,e as Ne}from"./DrawerTitle.vue_vue_type_script_setup_true_lang-CCwv0yPt.js";import{E as Ve}from"./eye-CZ9I1zkN.js";import{u as qe}from"./useFetchRoles-BQaHJG7l.js";/**
 * @license lucide-vue-next v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=H("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Me={class:"mx-auto w-full max-w-lg p-4"},Oe={class:"mt-4 bg-white dark:bg-slate-300 shadow-lg rounded-lg p-4"},Ue={class:"mb-4"},je={class:"flex justify-between"},He={class:"text-gray-700"},Le={class:"flex flex-col"},Te=R({__name:"RoleDetail",props:{isDrawerOpen:{type:Boolean},role:{}},emits:["update:drawer-state"],setup(v,{emit:n}){const c=n;function k(p){c("update:drawer-state",p)}return(p,l)=>(g(),b(e(Ne),{open:p.isDrawerOpen,"onUpdate:open":l[0]||(l[0]=d=>k(d))},{default:t(()=>[s(e(Ce),null,{default:t(()=>[f("div",Me,[s(e(Ee),null,{default:t(()=>[s(e(Ae),{class:"text-xl font-semibold dark:text-slate-200"},{default:t(()=>l[1]||(l[1]=[i("Detalles del rol")])),_:1}),s(e(Fe),{class:"text-gray-500"},{default:t(()=>l[2]||(l[2]=[i(" Aquí puedes ver los detalles de este rol. ")])),_:1})]),_:1}),f("div",Oe,[f("div",Ue,[l[6]||(l[6]=f("h3",{class:"text-lg font-bold"},"Información de rol",-1)),f("div",je,[l[3]||(l[3]=f("span",{class:"font-medium"},"Nombre:",-1)),f("span",He,$(p.role.description),1)]),f("div",Le,[l[5]||(l[5]=f("span",{class:"font-medium"},"Permisos:",-1)),s(e(L),{class:"mt-4"},{default:t(()=>[s(e(T),{placeholder:"Busca un permiso..."}),s(e(z),null,{default:t(()=>[s(e(W),null,{default:t(()=>l[4]||(l[4]=[i("No hay resultados.")])),_:1}),(g(!0),S(V,null,O(p.role.permissions,d=>(g(),b(e(G),{class:"flex text-green-700 dark:text-green-600",value:d.description},{default:t(()=>[s(e(Be),{class:"mr-2"}),i(" "+$(d.description),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1})])])]),s(e(Ie),{class:"mt-4"},{default:t(()=>[s(e(J),{"as-child":""},{default:t(()=>[s(q,{variant:"outline",class:"w-full dark:text-slate-200"},{default:t(()=>l[7]||(l[7]=[i(" Cerrar ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["open"]))}}),ze=R({__name:"DropdownRoleOptions",props:{role:{}},emits:["update:role-form"],setup(v,{emit:n}){const c=v,k=n;function p(){k("update:role-form",c.role)}const l=D(!1),d=()=>{l.value=!0},w=x=>{l.value=x};return(x,u)=>(g(),S(V,null,[s(e(Z),null,{default:t(()=>[s(e(K),{"as-child":""},{default:t(()=>[s(e(q),{variant:"ghost",class:"w-8 h-8 p-0"},{default:t(()=>[u[0]||(u[0]=f("span",{class:"sr-only"},"Abrir menu",-1)),s(e(_e),{class:"w-4 h-4"})]),_:1})]),_:1}),s(e(Q),{align:"end"},{default:t(()=>[s(e(X),null,{default:t(()=>u[1]||(u[1]=[i("Opciones")])),_:1}),s(e(B),{onClick:Y(d,["stop"]),class:"flex items-center gap-x-2 py-2 cursor-pointer"},{default:t(()=>[s(e(Ve),{class:"w-5 h-5"}),u[2]||(u[2]=i(" Ver "))]),_:1}),s(ge,{class:"w-full"},{default:t(()=>[s(e(B),{onClick:p,class:"flex items-center gap-x-2 text-sky-700 dark:text-sky-500 py-2 cursor-pointer"},{default:t(()=>[s(e(he),{class:"w-5 h-5"}),u[3]||(u[3]=i(" Editar "))]),_:1})]),_:1})]),_:1})]),_:1}),s(Te,{"is-drawer-open":l.value,role:x.role,"onUpdate:drawerState":w},null,8,["is-drawer-open","role"])],64))}});function We(v){return ee(N.roles,v)}const Ge={class:"flex flex-col sm:grid grid-cols-2 gap-x-2 gap-y-1 overflow-y-auto max-h-[71vh] p-1"},Je={class:"flex items-center space-x-2 my-1 col-span-full"},Ke={class:"flex items-center space-x-2 my-1"},Qe={key:0,class:"text-[0.8rem] font-medium text-red-500 dark:text-red-900 col-span-full"},Xe=R({__name:"RoleModal",props:{form:{}},emits:["reset"],setup(v,{emit:n}){const c=v,k=n;function p(){k("reset")}const l=I(()=>!!c.form.values.id),d=I(()=>({url:`${h.roles}/${l.value?h.update_action:h.store_action}`,method:l.value?h.put:h.post})),{isPending:w,mutateAsync:x}=We(d),u=c.form.handleSubmit(m=>{const o=_.value.filter(a=>a.checked).map(a=>a.id);return m.permissions=o,ae(x(m),`${l.value?"Editando":"Agregando"}...`,()=>(p(),`Inquilino ${l.value?"actualizado":"agregado"} con éxito`),a=>typeof a=="object"?(c.form.setErrors(a),"Acción fallida"):a)}),C=D([]),_=D([]);se(async()=>{C.value=(await te(`${h.roles}/${h.permissions}`)).data}),le(()=>c.form.values.permissions,()=>{const m=c.form.values.permissions,o=C.value.map(a=>({...a,checked:m.some(r=>r.id===a.id)}));_.value=o});const F=(m,o)=>{const a=_.value.map(r=>r.id===m?{...r,checked:o}:r);_.value=a},E=()=>{const m=_.value.map(o=>({...o,checked:!o.checked}));_.value=m},y=I(()=>!!_.value.every(m=>m.checked));return(m,o)=>(g(),b(e(xe),{class:"sm:max-w-[600px] text-slate-800 dark:dark:text-slate-200"},{default:t(()=>[s(e(ve),null,{default:t(()=>[s(e($e),null,{default:t(()=>[i($(l.value?"Editar":"Agregar")+" rol",1)]),_:1}),s(e(ke),null,{default:t(()=>[i(" Haz los cambios del rol aquí. Click "+$(l.value?"Editar":"Agregar")+" cuando termines. ",1)]),_:1})]),_:1}),f("form",{onSubmit:o[0]||(o[0]=(...a)=>e(u)&&e(u)(...a)),"keep-values":""},[f("section",Ge,[s(e(ie),{name:"description"},{default:t(({componentField:a})=>[s(e(ce),{class:"col-span-full"},{default:t(()=>[s(e(de),null,{default:t(()=>o[1]||(o[1]=[i("Nombre")])),_:1}),s(e(ue),null,{default:t(()=>[s(e(me),ne(a,{autocomplete:"off"}),null,16)]),_:2},1024),s(e(fe))]),_:2},1024)]),_:1}),f("div",Je,[s(e(A),{id:"all-checked",checked:y.value,onClick:E},null,8,["checked"]),s(e(M),{for:"all-checked"},{default:t(()=>[i($(y.value?"Desmarcar":"Marcar")+" los permisos",1)]),_:1})]),(g(!0),S(V,null,O(_.value,a=>(g(),S("div",Ke,[s(e(A),{id:a.id.toString(),checked:a.checked,onClick:r=>F(a.id,!a.checked)},null,8,["id","checked","onClick"]),s(e(M),{for:a.id.toString()},{default:t(()=>[i($(a.description),1)]),_:2},1032,["for"])]))),256)),_.value.every(a=>!a.checked)?(g(),S("p",Qe,$(c.form.errors.value.permissions),1)):U("",!0)]),s(e(we),null,{default:t(()=>[s(e(q),{type:"submit",class:"w-full mt-3 p-1",disabled:e(w)},{default:t(()=>[i($(l.value?"Editar":"Agregar"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1}))}}),Ye=R({__name:"RoleContainer",setup(v){const n=oe({page:1,limit:window.innerWidth<768?5:10,searchParam:""}),{isFetching:c,data:k,meta:p}=qe(N.roles,n),l={id:void 0,name:"",description:"",permissions:[]},d=Re(),w=pe(),x=()=>{w.setValues(l)},u=a=>{w.setValues(a)},C=a=>{n.page=a.length>2?1:n.page,n.searchParam=a},_=a=>{n.page=a},F=a=>{n.page=1,n.limit=a},E=D(0),y=D(!1),m=()=>{y.value=!1},o=[d.display({id:"select",header:({table:a})=>P(A,{checked:a.getIsAllPageRowsSelected()||a.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:checked":r=>a.toggleAllPageRowsSelected(!!r),ariaLabel:"Select all",class:"mr-2"}),cell:({row:a})=>P(A,{checked:a.getIsSelected(),"onUpdate:checked":r=>a.toggleSelected(!!r),ariaLabel:"Select row"}),enableHiding:!1}),d.accessor("id",{header:"ID",cell:a=>P("span",a.getValue()??"")}),d.accessor("description",{header:"Descripción",cell:a=>P("div",{class:"max-w-60 truncate"},a.getValue())}),d.display({id:"actions",cell:({row:a})=>{const r=a.original;return P("div",{class:"relative"},P(ze,{role:r,"onUpdate:roleForm":u}))},enableHiding:!1})];return(a,r)=>(g(),b(e(De),{open:y.value,"onUpdate:open":r[0]||(r[0]=j=>y.value=j)},{default:t(()=>[s(ye,{icon:e(re),title:"Gestión de roles",isFetching:e(c),"onReset:initialForm":x},null,8,["icon","isFetching"]),s(Xe,{form:e(w),onReset:m},null,8,["form"]),s(Pe,{render:!!n.searchParam,filters:[{render:!!n.searchParam,tag:"Búsqueda",name:n.searchParam,handleClick:()=>{E.value+=1,n.searchParam="",n.page=1}}]},null,8,["render","filters"]),s(be,{data:e(k),columns:o,"delete-name":e(N).roles,"delete-url":`${e(h).roles}/${e(h).destroy_action}`,"title-dialog":"¿Estás seguro que quieres eliminar a los roles seleccionados?","description-dialog":"Esta acción no se podrá deshacer. Esto eliminará a los roles seleccionados permanentemente.","on-search-input":C,"input-render":E.value},null,8,["data","delete-name","delete-url","input-render"]),e(p)?(g(),b(Se,{key:0,meta:e(p),"on-change-page":_,"on-change-limit":F},null,8,["meta"])):U("",!0)]),_:1},8,["open"]))}}),na=R({__name:"RoleView",setup(v){return(n,c)=>(g(),b(Ye))}});export{na as default};
