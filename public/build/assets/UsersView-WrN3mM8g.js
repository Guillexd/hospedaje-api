import{d as H,o as h,i as P,w as s,j as a,u as e,m as i,k as u,v as x,A as ae,h as A,a as J,B as se,C as te,D as le,E as O,F as ne,G as re,H as oe,I as ie,J as Q,K as ue,L as B,M as de,f as D,e as me,N as T,s as Z,O as ee,P as ce,p as L,n as K,b as X,Q as fe,R as pe,q as G,S as _e,T as ge,U as ve,V as $e,W as he,X as we,Y as ye,Z as xe,$ as be,a0 as k,a1 as ke}from"./app-_lgDiFIF.js";import{e as W,F as U,_ as C,a as V,b as F,c as j,d as E,u as Pe}from"./Input.vue_vue_type_script_setup_true_lang-CJBlVlO3.js";import{E as De,_ as Se,S as Ue,a as Ce,b as Ve,c as Fe,r as Ee,X as Ae,d as Ne,e as Ie,f as Re,g as Y,h as je,i as Be,j as He,k as qe,l as ze,m as Me}from"./FilterBarPresentation.vue_vue_type_script_setup_true_lang-CFMY4aMz.js";import{_ as Oe,a as Le,b as Te,c as We,d as Ge,e as Ke}from"./DrawerTitle.vue_vue_type_script_setup_true_lang-CPvPlu3Q.js";import{E as Xe}from"./eye-sj_jIObT.js";import{P as Ye,M as Je}from"./phone-outgoing-BpxXoVJL.js";import{t as Qe,_ as Ze}from"./tableNames-rTtQdpKN.js";import{_ as ea,a as aa,b as sa}from"./PopoverTrigger.vue_vue_type_script_setup_true_lang-duuPVoGo.js";import{u as ta}from"./useFetchRoles-n8TXAkEz.js";import{S as la}from"./search-ztKx_rn0.js";const na={class:"mx-auto w-full max-w-lg p-4"},ra={class:"mt-4 bg-white dark:bg-slate-300 shadow-lg rounded-lg p-4"},oa={class:"mb-4"},ia={class:"flex justify-between"},ua={class:"text-gray-700"},da={class:"flex justify-between"},ma={class:"text-gray-700"},ca={class:"flex justify-between"},fa={class:"text-gray-700"},pa={class:"flex justify-between"},_a={class:"text-gray-700"},ga={class:"flex justify-between"},va={class:"text-gray-700"},$a=H({__name:"UserDetail",props:{isDrawerOpen:{type:Boolean},user:{}},emits:["update:drawer-state"],setup(w,{emit:f}){const r=f;function $(o){r("update:drawer-state",o)}return(o,n)=>(h(),P(e(Ke),{open:o.isDrawerOpen,"onUpdate:open":n[0]||(n[0]=b=>$(b))},{default:s(()=>[a(e(Oe),null,{default:s(()=>[i("div",na,[a(e(Le),null,{default:s(()=>[a(e(Te),{class:"text-xl font-semibold dark:text-slate-200"},{default:s(()=>n[1]||(n[1]=[u("Detalles de usuario")])),_:1}),a(e(We),{class:"text-gray-500"},{default:s(()=>n[2]||(n[2]=[u(" Aquí puedes ver los detalles de este usuario. ")])),_:1})]),_:1}),i("div",ra,[i("div",oa,[n[8]||(n[8]=i("h3",{class:"text-lg font-bold"},"Información Personal",-1)),i("div",ia,[n[3]||(n[3]=i("span",{class:"font-medium"},"Nombre:",-1)),i("span",ua,x(o.user.name),1)]),i("div",da,[n[4]||(n[4]=i("span",{class:"font-medium"},"DNI:",-1)),i("span",ma,x(o.user.dni),1)]),i("div",ca,[n[5]||(n[5]=i("span",{class:"font-medium"},"Teléfono:",-1)),i("span",fa,x(o.user.phone),1)]),i("div",pa,[n[6]||(n[6]=i("span",{class:"font-medium"},"Correo:",-1)),i("span",_a,x(o.user.email),1)]),i("div",ga,[n[7]||(n[7]=i("span",{class:"font-medium"},"Rol:",-1)),i("span",va,x(o.user.role),1)])])]),a(e(Ge),{class:"mt-4"},{default:s(()=>[a(e(ae),{"as-child":""},{default:s(()=>[a(W,{variant:"outline",class:"w-full dark:text-slate-200"},{default:s(()=>n[9]||(n[9]=[u(" Cerrar ")])),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["open"]))}}),ha=H({__name:"DropdownUserOptions",props:{user:{}},emits:["update:user-form"],setup(w,{emit:f}){const r=w,$=f;function o(){$("update:user-form",r.user)}const n=A(!1),b=()=>{n.value=!0},d=g=>{n.value=g};return(g,c)=>(h(),J(Q,null,[a(e(ie),null,{default:s(()=>[a(e(se),{"as-child":""},{default:s(()=>[a(e(W),{variant:"ghost",class:"w-8 h-8 p-0"},{default:s(()=>[c[0]||(c[0]=i("span",{class:"sr-only"},"Abrir menu",-1)),a(e(De),{class:"w-4 h-4"})]),_:1})]),_:1}),a(e(te),{align:"end"},{default:s(()=>[a(e(le),null,{default:s(()=>c[1]||(c[1]=[u("Opciones")])),_:1}),a(e(O),{onClick:ne(b,["stop"]),class:"flex items-center gap-x-2 py-2 cursor-pointer"},{default:s(()=>[a(e(Xe),{class:"w-5 h-5"}),c[2]||(c[2]=u(" Ver "))]),_:1}),a(Se,{class:"w-full"},{default:s(()=>[a(e(O),{onClick:o,class:"flex items-center gap-x-2 text-sky-700 dark:text-sky-500 py-2 cursor-pointer"},{default:s(()=>[a(e(Ue),{class:"w-5 h-5"}),c[3]||(c[3]=u(" Editar "))]),_:1})]),_:1}),a(e(O),{as:"a",class:"flex items-center gap-x-2 text-red-700 dark:text-red-500 py-2 cursor-pointer",href:e(re)(g.user.phone)},{default:s(()=>[a(e(Ye),{class:"w-5 h-5"}),c[4]||(c[4]=u(" Llamar "))]),_:1},8,["href"]),a(e(O),{as:"a",class:"flex items-center gap-x-2 text-green-700 dark:text-green-500 py-2 cursor-pointer",href:e(oe)(g.user.phone,"?text=Buen%20día"),target:"_blank"},{default:s(()=>[a(e(Je),{class:"w-5 h-5"}),c[5]||(c[5]=u(" Whatsapp "))]),_:1},8,["href"])]),_:1})]),_:1}),a($a,{"is-drawer-open":n.value,user:g.user,"onUpdate:drawerState":d},null,8,["is-drawer-open","user"])],64))}});function wa(w,f){const r=()=>de(`${D.users}/${D.list_action}?page=${f.page}&limit=${f.limit}&searchInput=${f.searchParam}&startDate=${f.startDate}&finishDate=${f.finishDate}`),{data:$,...o}=ue(w,r,f),n=B(()=>{var d;return((d=$.value)==null?void 0:d.data)??[]}),b=B(()=>{var d;return((d=$.value)==null?void 0:d.meta)??null});return{data:n,meta:b,...o}}function ya(w){return me(T.users,w)}const xa={class:"flex flex-col sm:grid grid-cols-2 gap-x-2 gap-y-1 overflow-y-auto max-h-[71vh] p-1"},ba={class:"relative transition-all ease-in-out"},ka=H({__name:"UserModal",props:{form:{}},emits:["reset"],setup(w,{emit:f}){const r=w,$=f,o=B(()=>!!r.form.values.id),n=B(()=>({url:`${D.users}/${o.value?D.update_action:D.store_action}`,method:o.value?D.put:D.post})),{isPending:b,mutateAsync:d}=ya(n),g=r.form.handleSubmit(p=>(p.password_confirmation=p.password,Z(d(p),`${o.value?"Editando":"Agregando"}...`,()=>(R(),`Usuario ${o.value?"actualizado":"agregado"} con éxito`),t=>typeof t=="object"?(r.form.setErrors(t),"Acción fallida"):t))),c=()=>{xe(r.form.values.dni,p=>{r.form.setValues({name:p})},(p,t,m)=>{r.form.setValues({name:`${p} ${t} ${m}`})})},N=A(!1),y=A(""),I=A(1),S=ee({page:1,limit:20,searchParam:"",active:1}),{data:q}=ta("",S);function R(){$("reset"),z(!1)}function z(p){p?(S.searchParam=r.form.values.role,y.value=r.form.values.role):(S.searchParam="",y.value="",I.value++)}return ce(o,p=>{z(p)}),(p,t)=>(h(),P(e(Re),{class:"sm:max-w-[600px] text-slate-800 dark:dark:text-slate-200"},{default:s(()=>[a(e(Ce),null,{default:s(()=>[a(e(Ve),null,{default:s(()=>[u(x(o.value?"Editar":"Agregar")+" usuario",1)]),_:1}),a(e(Fe),null,{default:s(()=>[u(" Haz los cambios del usuario aquí. Click "+x(o.value?"Editar":"Agregar")+" cuando termines. ",1)]),_:1})]),_:1}),i("form",{onSubmit:t[4]||(t[4]=(...m)=>e(g)&&e(g)(...m)),"keep-values":""},[i("section",xa,[a(e(U),{name:"name"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[5]||(t[5]=[u("Nombre")])),_:1}),a(e(F),null,{default:s(()=>[a(e(j),L(m,{autocomplete:"off"}),null,16)]),_:2},1024),a(e(E))]),_:2},1024)]),_:1}),a(e(U),{name:"dni"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[6]||(t[6]=[u("DNI")])),_:1}),a(e(F),null,{default:s(()=>[i("div",ba,[a(e(la),{class:"absolute left-1 bottom-1 hover:scale-110 cursor-pointer text-green-500",size:30,onClick:c}),a(e(j),L({type:"number",class:"pl-11"},m,{autocomplete:"off",max:"999999999"}),null,16)])]),_:2},1024),a(e(E))]),_:2},1024)]),_:1}),a(e(U),{name:"phone"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[7]||(t[7]=[u("Celular")])),_:1}),a(e(F),null,{default:s(()=>[a(e(j),L({type:"number"},m,{autocomplete:"off",max:"999999999"}),null,16)]),_:2},1024),a(e(E))]),_:2},1024)]),_:1}),a(e(U),{name:"role_id"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[8]||(t[8]=[u("Rol")])),_:1}),a(e(ea),{open:N.value,"onUpdate:open":t[3]||(t[3]=_=>N.value=_)},{default:s(()=>[a(e(aa),{"as-child":""},{default:s(()=>[a(e(F),null,{default:s(()=>[a(e(W),{type:"button",variant:"outline",role:"combobox",class:K(e(X)("w-full sm:w-64 justify-between",!m.modelValue&&"text-muted-foreground"))},{default:s(()=>[u(x(y.value||"Selecciona el rol...")+" ",1),a(e(Ee),{class:"ml-2 h-4 w-4 shrink-0 opacity-50"})]),_:2},1032,["class"])]),_:2},1024)]),_:2},1024),a(e(sa),{class:"w-[370px] sm:w-64 p-0"},{default:s(()=>[(h(),P(e(fe),{key:I.value,modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=_=>y.value=_),class:"p-0"},{default:s(()=>[a(e(pe),{class:"w-full px-4 py-2",placeholder:"Busca el rol...",onInput:t[0]||(t[0]=_=>S.searchParam=_.target.value)}),y.value.length>0||S.searchParam.length>0?(h(),P(e(Ae),{key:0,class:"absolute right-5 top-3",size:20,onClick:t[1]||(t[1]=()=>{S.searchParam="",y.value="",I.value++})})):G("",!0),a(e(_e),null,{default:s(()=>t[9]||(t[9]=[u("Sin resultados.")])),_:1}),a(e(ge),null,{default:s(()=>[a(e(ve),null,{default:s(()=>[(h(!0),J(Q,null,$e(e(q),_=>(h(),P(e(he),{key:_.id,value:_.description,onSelect:()=>{r.form.setFieldValue("role_id",_.id),y.value=_.description,N.value=!1}},{default:s(()=>[u(x(_.description)+" ",1),a(e(Ne),{class:K(e(X)("ml-auto h-4 w-4",r.form.values.role_id==_.id?"opacity-100":"opacity-0"))},null,8,["class"])]),_:2},1032,["value","onSelect"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]))]),_:1})]),_:2},1032,["open"]),a(e(E))]),_:2},1024)]),_:1}),a(e(U),{name:"email"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[10]||(t[10]=[u("Correo electrónico")])),_:1}),a(e(F),null,{default:s(()=>[a(e(j),L(m,{autocomplete:"off"}),null,16)]),_:2},1024),a(e(E))]),_:2},1024)]),_:1}),o.value?G("",!0):(h(),P(e(U),{key:0,name:"password"},{default:s(({componentField:m})=>[a(e(C),null,{default:s(()=>[a(e(V),null,{default:s(()=>t[11]||(t[11]=[u("Contraseña")])),_:1}),a(e(F),null,{default:s(()=>[a(e(j),we(ye(m)),null,16)]),_:2},1024),a(e(E))]),_:2},1024)]),_:1}))]),a(e(Ie),null,{default:s(()=>[a(e(W),{type:"submit",class:"w-full mt-3 p-1",disabled:e(b)},{default:s(()=>[u(x(o.value?"Editar":"Agregar"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1}))}}),Pa=H({__name:"UserContainer",setup(w){const f=B(()=>window.innerWidth<768?{id:!1,email:!1}:{id:!1,email:!0}),r=ee({page:1,limit:window.innerWidth<768?5:10,searchParam:"",startDate:"",finishDate:""}),{isFetching:$,data:o,meta:n}=wa(T.users,r),b={id:void 0,role_id:void 0,name:"",email:"",password:`$HSL-${new Date().getFullYear()}$`,dni:"",phone:""},d=Me(),g=Pe(),c=()=>{g.setValues(b)},N=l=>{g.setValues(l)},y=l=>{r.page=l.length>2?1:r.page,r.searchParam=l},I=l=>{r.page=l},S=l=>{r.page=1,r.limit=l},q=A(0),R=A(!1),z=()=>{R.value=!1},{isPending:p,mutateAsync:t}=be(T.users,Qe.user),m=(l,v)=>Z(t({id:l,state:v}),`${v?"Activando":"Desactivando"}...`,()=>`Propiedad ${v?"activada":"desactivada"} con éxito`,M=>typeof M=="object"?"Acción fallida":M),_=[d.display({id:"select",header:({table:l})=>k(Y,{checked:l.getIsAllPageRowsSelected()||l.getIsSomePageRowsSelected()&&"indeterminate","onUpdate:checked":v=>l.toggleAllPageRowsSelected(!!v),ariaLabel:"Select all",class:"mr-2 md:mr-0"}),cell:({row:l})=>k(Y,{checked:l.getIsSelected(),"onUpdate:checked":v=>l.toggleSelected(!!v),ariaLabel:"Select row"}),enableHiding:!1}),d.accessor("id",{header:"ID",cell:l=>k("span",l.getValue())}),d.accessor("name",{header:"Nombre",cell:l=>k("span",{class:"capitalize min-w-28"},l.getValue())}),d.accessor("email",{header:"Correo electrónico",cell:l=>k("span",l.getValue())}),d.accessor("dni",{header:"DNI",cell:l=>k("span",l.getValue())}),d.accessor("is_active",{header:"Estado",cell:({row:l})=>k(Ze,{checked:!!l.getValue("is_active"),"onUpdate:checked":()=>m(l.getValue("id"),!l.getValue("is_active")),disabled:p.value||$.value})}),d.display({id:"actions",cell:({row:l})=>{const v=l.original;return k("div",{class:"relative"},k(ha,{user:v,"onUpdate:userForm":N}))},enableHiding:!1})];return(l,v)=>(h(),P(e(ze),{open:R.value,"onUpdate:open":v[0]||(v[0]=M=>R.value=M)},{default:s(()=>[a(je,{icon:e(ke),title:"Gestión de usuarios",isFetching:e($),"onReset:initialForm":c},null,8,["icon","isFetching"]),a(ka,{form:e(g),onReset:z},null,8,["form"]),a(Be,{render:!!r.searchParam,filters:[{render:!!r.searchParam,tag:"Búsqueda",name:r.searchParam,handleClick:()=>{q.value+=1,r.searchParam="",r.page=1}}]},null,8,["render","filters"]),a(He,{data:e(o),columns:_,"default-visible-columns":f.value,"delete-name":e(T).users,"delete-url":`${e(D).users}/${e(D).destroy_action}`,"title-dialog":"¿Estás seguro que quieres eliminar a los usuarios seleccionados?","description-dialog":"Esta acción no se podrá deshacer. Esto eliminará a los usuarios seleccionados permanentemente.","on-search-input":y,"input-render":q.value},null,8,["data","default-visible-columns","delete-name","delete-url","input-render"]),e(n)?(h(),P(qe,{key:0,meta:e(n),"on-change-page":I,"on-change-limit":S},null,8,["meta"])):G("",!0)]),_:1},8,["open"]))}}),Ra=H({__name:"UsersView",setup(w){return(f,r)=>(h(),P(Pa))}});export{Ra as default};
